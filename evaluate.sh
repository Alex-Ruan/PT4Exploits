#!/bin/bash

SRC_DIR=$PWD/utils
cd $PWD


dataset_str=decoder


data_dir=$2;
echo $2;

output_dir='eval/'$1
echo $output_dir

python $SRC_DIR/eval_prep.py $1

python $SRC_DIR/seq2seq_output_to_code.py $1 ${data_dir}/$dataset_str-test.json.seq2seq ${output_dir}/${dataset_str}_test_output.json ${dataset_str}


cp ${data_dir}/${dataset_str}-test.json ${output_dir}/${dataset_str}_test_gold.json # gold文件直接靠复制
python $SRC_DIR/codegen_eval.py --strip_ref_metadata --input_ref ${output_dir}/${dataset_str}_test_gold.json --input_hyp ${output_dir}/${dataset_str}_test_output.json
